function JSONstat(t,e){return window===this?new JSONstat.jsonstat(t,e):void 0}var JSONstat=JSONstat||{};JSONstat.version="0.6.2",function(){"use strict";function t(t){return"[object Array]"===Object.prototype.toString.call(t)}function e(e,n){function i(e,n,i,r){var s=[];if("string"==typeof n&&(n=[n]),t(n)){if(n.length===r)return n;if(1===n.length){for(var a=0;r>a;a++)s.push(n[0]);return s}}return e["sparse"+i]=!0,n}var r=function(t,e){var n,i=e!==!1;if(window.XDomainRequest&&/^(http(s)?:)?\/\//.test(t)){if(!i)return;var r=new XDomainRequest;r.onload=function(){n=JSON.parse(r.responseText),e.call(JSONstat(n))},r.open("GET",t),r.send()}else{var r=new XMLHttpRequest;if(r.onreadystatechange=function(){if(4===r.readyState){var t=r.status;n=t&&r.responseText&&(t>=200&&300>t||304===t)?JSON.parse(r.responseText):null,i&&e.call(JSONstat(n))}},r.open("GET",t,i),r.send(null),!i)return n}};if(this.length=0,this.id=[],null!==e&&"undefined"!=typeof e){var s=e.type||"root";switch(s){case"root":this.type="root";var a=[],o=0;if("string"==typeof e&&e.length>0&&(e=r(e,"function"==typeof n?n:!1)),null===e||"object"!=typeof e)return;for(var u in e)o++,a.push(u);this.__tree__=e,this.length=o,this.id=a;break;case"ds":if(this.type="ds",!e.hasOwnProperty("__tree__"))return;var l=e.__tree__;this.__tree__=l,this.label=l.label||null,this.updated=l.updated||null,this.source=l.source||null;var h=0;if(l.hasOwnProperty("value")&&t(l.value))h=l.value.length;else if(l.hasOwnProperty("status")&&t(l.status))h=l.status.length;else if(l.hasOwnProperty("dimension")){for(var f=this.__tree__.dimension.size,d=1,p=f.length;p--;)d*=f[p];h=d}if(this.value=i(this,l.value,"value",h),this.status=l.hasOwnProperty("status")?i(this,l.status,"status",h):null,l.hasOwnProperty("dimension")){if(!t(l.dimension.id)||!t(l.dimension.size)||l.dimension.id.length!=l.dimension.size.length)return;var v=l.dimension;this.length=v.size.length,this.id=v.id,this.role=v.role,this.n=h;for(var y=0,c=this.length;c>y;y++)if(v[v.id[y]].category.hasOwnProperty("index")){if(t(v[v.id[y]].category.index)){for(var g={},_=v[v.id[y]].category.index,a=0,b=_.length;b>a;a++)g[_[a]]=a;v[v.id[y]].category.index=g}}else{var m=0;v[v.id[y]].category.index={};for(var u in v[v.id[y]].category.label)v[v.id[y]].category.index[u]=m++}}else this.length=0;break;case"dim":this.type="dim";var w=[],l=e.__tree__,O=l.category;if(!e.hasOwnProperty("__tree__")||!l.hasOwnProperty("category"))return;if(!O.hasOwnProperty("label")){O.label={};for(var u in O.index)O.label[u]=u}for(var u in O.index)w[O.index[u]]=u;this.__tree__=l,this.label=l.label||null,this.id=w,this.length=w.length,this.role=e.role,this.hierarchy=O.hasOwnProperty("child");break;case"cat":var x=e.child;this.type="cat",this.id=x,this.length=null===x?0:x.length,this.index=e.index,this.label=e.label,this.unit=e.unit,this.coordinates=e.coord}}}e.prototype.Dataset=function(t){if(null===this||"root"!==this.type)return null;if("undefined"==typeof t){for(var n=[],i=0,r=this.id.length;r>i;i++)n.push(this.Dataset(this.id[i]));return n}if("number"==typeof t){var s=this.id[t];return"undefined"!=typeof s?this.Dataset(s):null}var a=this.__tree__[t];return"undefined"==typeof a?null:new e({type:"ds",__tree__:a})},e.prototype.Dimension=function(t){function n(t,e){var n=t.role;if("undefined"!=typeof n)for(var i in n)for(var r=n[i].length;r--;)if(n[i][r]===e)return i;return null}if(null===this||"ds"!==this.type)return null;if("undefined"==typeof t){for(var i=[],r=0,s=this.id.length;s>r;r++)i.push(this.Dimension(this.id[r]));return i}if("number"==typeof t){var a=this.id[t];return"undefined"!=typeof a?this.Dimension(a):null}var o=this.__tree__.dimension;if("undefined"==typeof o)return null;if("object"==typeof t){if(t.hasOwnProperty("role")){for(var i=[],r=0,s=this.id.length;s>r;r++){var u=this.id[r];n(o,u)===t.role&&i.push(this.Dimension(u))}return"undefined"==typeof i[0]?null:i}return null}var l=o[t];return"undefined"==typeof l?null:new e({type:"dim",__tree__:l,role:n(o,t)})},e.prototype.Category=function(t){if(null===this||"dim"!==this.type)return null;if("undefined"==typeof t){for(var n=[],i=0,r=this.id.length;r>i;i++)n.push(this.Category(this.id[i]));return n}if("number"==typeof t){var s=this.id[t];return"undefined"!=typeof s?this.Category(s):null}var a=this.__tree__.category;if("undefined"==typeof a)return null;var o=a.index[t];if("undefined"==typeof o)return null;var u=a.unit&&a.unit[t]||null,l=a.coordinates&&a.coordinates[t]||null,h=a.child&&a.child[t]||null;return new e({type:"cat",index:o,label:a.label[t],child:h,unit:u,coord:l})},e.prototype.Data=function(e){function n(t){for(var e in t)if(t.hasOwnProperty(e))return e}function i(t,e){for(var i=[],r=t.dimension,s=r.id,a=0,o=s.length;o>a;a++){var u=s[a],l=e[u];i.push("string"==typeof l?l:1===r.size[a]?n(r[u].category.index):null)}return i}if(null===this||"ds"!==this.type)return null;if("undefined"==typeof e){var r=[];if(this.sparsevalue){var s=Object.keys(this.value);s.forEach(function(t){r.push(this.Data(+t))},this)}else for(var a=0,o=this.value.length;o>a;a++)r.push(this.Data(a));return r}if("number"==typeof e){var u=this.value[e];return"undefined"!=typeof u?{value:u,status:this.status?this.status[e]:null,index:e}:null}var l=this.__tree__,h=l.dimension.size,f=h.length;if(t(e)){if(this.length!==e.length)return null;for(var d=1,p=0,v=[],y=[],r=[],a=0;f>a;a++)if("undefined"!=typeof e[a]){if("number"!=typeof e[a]||e[a]>=h[a])return null;d*=a>0?h[f-a]:1,p+=d*e[f-a-1]}else v.push(a),y.push(h[a]);if(v.length>1){var c=f-v.length,g=function(t){for(var n=+t,i=!0,s=f,a=c;--s>=0&&i&&a>0;)null!==e[s]&&void 0!==e[s]&&(i=n%h[s]===e[s],a--),n=Math.floor(n/h[s]);i&&r.push(this.Data(+t))};if(this.sparsevalue){var s=Object.keys(this.value);s.forEach(g,this)}else for(var _=0;_<this.value.length;_++)g.call(this,_);return r}if(1===v.length){for(var b=0,m=y[0];m>b;b++){for(var w=[],a=0;f>a;a++)w.push(a!==v[0]?e[a]:b);r.push(this.Data(w))}return r}return{value:this.value[p],status:this.status?this.status[p]:null,index:p}}for(var O=i(l,e),x=[],D=l.dimension,a=0,o=O.length;o>a;a++)x.push(D[D.id[a]].category.index[O[a]]);return this.Data(x)},e.prototype.toTable=function(t,e){function n(e){V=[];for(var n=this.dimsFromIndex(e),i=0,r=n.length;r>i;i++)b(S[i][n[i]]);t.status&&b(this.status[e]),m(this.value[e])}if(null===this||"ds"!==this.type)return null;1==arguments.length&&"function"==typeof t&&(e=t,t=null);var i=this.__tree__,t=t||{field:"label",content:"label",vlabel:"Value",slabel:"Status",type:"array",status:!1};if("function"==typeof e){var r=this.toTable(t),s=[],a="array"!==t.type?0:1;if("object"!==t.type)var o=r.slice(a);else var o=r.rows.slice(0);for(var u=0,l=o.length;l>u;u++){var h=e.call(this,o[u],u);"undefined"!=typeof h&&s.push(h)}return"object"===t.type?{cols:r.cols,rows:s}:("array"===t.type&&s.unshift(r[0]),s)}if("arrobj"===t.type){for(var r=this.toTable({field:"id",content:t.content,status:t.status}),f=[],d=r.shift(),a=0,l=r.length;l>a;a++){for(var p={},v=r[a].length;v--;)p[d[v]]=r[a][v];f.push(p)}return f}var y="id"===t.field;if("object"===t.type)var c="number"==typeof this.value[0]||null===this.value[0]?"number":"string",g=function(t,e){var n=y&&t||e||t;J.push({id:t,label:n,type:"string"})},_=function(t,e,n){var i=y&&"value"||t||"Value",r=y&&"status"||e||"Status";n&&J.push({id:"status",label:r,type:"string"}),J.push({id:"value",label:i,type:c})},b=function(t){V.push({v:t})},m=function(t){V.push({v:t}),N.push({c:V})};else var g=function(t,e){var n=y&&t||e||t;J.push(n)},_=function(t,e,n){var i=y&&"value"||t||"Value",r=y&&"status"||e||"Status";n&&J.push(r),J.push(i),z.push(J)},b=function(t){V.push(t)},m=function(t){V.push(t),z.push(V)};var w=i.dimension,O=w.id,x=O.length,D=w.size;if(x!=D.length)return!1;for(var S=[],j=1,P=1,k=[],z=[],J=[],N=[],a=0;x>a;a++){var T=O[a],E=w[T].label;g(T,E),j*=D[a],P*=D[a];for(var q=[],v=0;v<D[a];v++)for(var M in w[O[a]].category.index)if(w[O[a]].category.index[M]===v){var C="id"!==t.content&&w[O[a]].category.label?w[O[a]].category.label[M]:M;q.push(C)}S.push(q),k.push(P)}_(t.vlabel,t.slabel,t.status);var V=[];if(this.sparsevalue)for(var R in this.value)this.value.hasOwnProperty(R)&&n.call(this,R);else for(var X=0;j>X;X++)n.call(this,X);return"object"===t.type?{cols:J,rows:N}:z},e.prototype.node=function(){return this.__tree__},e.prototype.toString=function(){return this.type},e.prototype.toValue=function(){return this.length},e.prototype.dimsFromIndex=function(t){for(var e=this.__tree__.dimension.size,n=new Array(e.length),i=e.length;--i>=0;)n[i]=t%e[i],t=Math.floor(t/e[i]);return n},e.prototype.sparseCount=function(t){var e=[];if(t){var n=this.__tree__.dimension.size,i=this.id.map(function(t){var e=this.Dimension(t);return{dim:t,counts:e.id.map(function(t){return{cat:t,count:0,vTot:0}})}},this);t.forEach(function(t){for(var e=+t,r=n.length;--r>=0;){var s=i[r].counts[e%n[r]];s.count++,s.vTot+=+this.value[t],e=Math.floor(e/n[r])}},this),e=i}return e},e.prototype.groupByDim=function(t,e){var n=[],i=this.Dimension(e),r=this.id.indexOf(e);if(t&&i){var s=this.__tree__.dimension.size,a=t.map(function(t){for(var e,n=+t,i=[],a=s.length;--a>=0;)a!==r?i[a]=n%s[a]:(i[a]="?",e=n%s[a]),n=Math.floor(n/s[a]);return{q:e,dkey:i.join("-"),key:t}},this),o=[];a.forEach(function(t){var e=t.dkey;o[e]=o[e]||[e];var n=o[e];n[t.q+1]=this.value[t.key]?+this.value[t.key]:null},this),n=o}return n},JSONstat.jsonstat=e}();